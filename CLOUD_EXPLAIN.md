# 云开发环境说明

## 🤔 云开发环境是干嘛的？

**云开发环境**是微信小程序提供的云端服务，主要作用：

1. **运行云函数** - 在云端执行代码（比如调用大模型API）
2. **安全存储** - API Key等敏感信息存储在云端，不会暴露在前端代码中
3. **无需服务器** - 不需要自己搭建后端服务器
4. **其他服务** - 还提供数据库、存储、CDN等服务

---

## ❓ 必须要接入云开发吗？

**不一定！** 有三种接入方式，你可以选择最适合的：

### 方式一：云开发（推荐）⭐

**优点**：
- ✅ 不需要自己搭建服务器
- ✅ API Key安全（存储在云端）
- ✅ 不需要配置域名
- ✅ 微信官方服务，稳定可靠

**缺点**：
- ❌ 需要开通云开发（有免费额度）
- ❌ 需要部署云函数

**适合**：大多数用户，特别是个人开发者

---

### 方式二：直接API调用

**优点**：
- ✅ 简单直接
- ✅ 不需要云开发

**缺点**：
- ❌ **API Key会暴露在前端代码中**（不安全）
- ❌ 需要在小程序后台配置合法域名
- ❌ 不推荐生产环境使用

**配置方法**：
1. 修改 `utils/config.js`：
```javascript
llmMode: "direct", // 改为 'direct'
enableLLM: true,
directAPI: {
  apiUrl: "https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation",
  apiKey: "sk-你的API Key", // 在这里填入
}
```

2. 在小程序后台配置合法域名：`dashscope.aliyuncs.com`

**适合**：快速测试，不推荐生产环境

---

### 方式三：后端代理

**优点**：
- ✅ API Key安全（在后端）
- ✅ 完全可控
- ✅ 可以做更多定制

**缺点**：
- ❌ 需要自己搭建后端服务器
- ❌ 需要维护服务器
- ❌ 需要配置域名

**适合**：有后端开发能力，需要更多定制

---

## 🎯 推荐方案

### 如果你只是想快速使用大模型：

**推荐使用云开发**，因为：
1. 最简单 - 不需要搭建服务器
2. 最安全 - API Key不会暴露
3. 免费额度 - 个人使用通常够用

### 如果你不想用云开发：

**可以使用直接API调用**（仅用于测试）：
1. 修改 `utils/config.js` 中的 `llmMode` 为 `"direct"`
2. 填入API Key
3. 配置合法域名

**⚠️ 注意**：这种方式API Key会暴露，不适合生产环境。

---

## 📝 如何选择？

| 场景 | 推荐方案 |
|------|---------|
| 个人开发，快速上线 | 云开发 ⭐ |
| 只是测试功能 | 直接API调用 |
| 有后端团队 | 后端代理 |
| 不想暴露API Key | 云开发或后端代理 |
| 不想配置域名 | 云开发 ⭐ |

---

## 🚀 如果选择云开发

### 开通步骤（5分钟）：

1. **开通云开发**
   - 在微信开发者工具中，点击顶部菜单 **云开发**
   - 点击 **开通**，选择套餐（有免费额度）
   - 记录下 **环境ID**（Environment ID）

2. **配置环境ID**
   - 打开 `utils/config.js`
   - 修改 `cloud.env` 为你的环境ID
   - 打开 `app.js`
   - 确保 `wx.cloud.init()` 中的环境ID一致

3. **部署云函数**
   - 右键 `cloudfunctions/emotionAnalysis` 文件夹
   - 选择 **"上传并部署：云端安装依赖"**
   - 等待部署完成

4. **配置API Key**
   - 打开 `cloudfunctions/emotionAnalysis/index.js`
   - 填入你的百炼平台API Key

5. **测试**
   - 在小程序中输入文案测试

---

## 💡 如果选择直接API调用

### 配置步骤：

1. **修改配置**
   ```javascript
   // utils/config.js
   llmMode: "direct",
   directAPI: {
     apiUrl: "https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation",
     apiKey: "sk-你的API Key",
   }
   ```

2. **配置合法域名**
   - 登录[微信公众平台](https://mp.weixin.qq.com/)
   - 进入 **开发** → **开发管理** → **开发设置**
   - 在 **服务器域名** → **request合法域名** 中添加：
     - `https://dashscope.aliyuncs.com`

3. **测试**
   - 在小程序中输入文案测试

---

## ⚠️ 重要提示

1. **API Key安全**
   - 云开发：API Key在云端，安全 ✅
   - 直接API：API Key在前端，不安全 ❌
   - 后端代理：API Key在后端，安全 ✅

2. **费用**
   - 云开发：有免费额度，超出后按量付费
   - 直接API：按大模型API费用（百炼平台）
   - 后端代理：服务器费用 + 大模型API费用

3. **推荐**
   - 生产环境：使用云开发或后端代理
   - 测试环境：可以使用直接API调用

---

## 🎯 总结

- **云开发不是必须的**，但推荐使用
- 如果你不想用云开发，可以用直接API调用（仅测试）
- 生产环境建议使用云开发或后端代理，保护API Key安全

你想用哪种方式？我可以帮你配置！

